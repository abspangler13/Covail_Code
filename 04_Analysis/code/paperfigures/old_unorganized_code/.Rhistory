here::here("01_raw-data", "FlowData", "FinalizedDatasets", "Filtered_COVAILDataset_250318_CORRECTED.xlsx")
here::here("01_raw-data", "COVAIL_unfiltered_MSD_Neut_IgG_Data.xlsx")
library(ggplot2)
library(dplyr)
library(here)
library(Seurat)
library(readxl)
library(tidyseurat)
library(stringr)
library(alakazam)
library(writexl)
library(gridExtra)
set.seed(1)
#set the colors
allColors <- c("Omicron BA.1 mRNA" = "#2AB673",
"Prototype + Omicron BA.1 mRNA" = "#1D75BC",
"Prototype mRNA" = "#FBB042")
immunogenColors <- c("Prototype" = "#FBB042",
"BA.1 And Prototype" = "#1D75BC",
"BA.1" = "#2AB673")
shortColors <- c("Atypical" = "#D53E4F", #based on RColorBrewer Spectral Palette
#"Acute Activated" = "#F46D43",
"Acute Activated" = "#f08665",
"Intermediate" = "#E6F598",
"Resting IgG" = "limegreen",
"Resting IgA" = "#3288BD",
"Plasmablast-like" = "#6f2da8",
"Naive" = "white")
#load in the data
seuObjNaive <- readRDS(file = here::here("04_Analysis", "data_objects", "06_additional_demultiplexing", "covObj_clustered_demultiplexed.rds"))
seuObj <- seuObjNaive %>% filter(ClusterLabel != "Naive")
df <- seuObj@meta.data
df <- df %>%
mutate(OfficialBooster = case_when(Booster == "Omicron" ~ "Omicron BA.1 mRNA",
Booster == "Omicron And Prototype" ~ "Prototype + Omicron BA.1 mRNA",
Booster == "Prototype" ~ "Prototype mRNA"),
Booster = str_replace(Booster, "Omicron", "BA.1"),
OfficialBooster = factor(OfficialBooster, levels = c("Prototype mRNA", "Prototype + Omicron BA.1 mRNA", "Omicron BA.1 mRNA")),
Booster = factor(Booster, levels = c("Prototype", "BA.1 And Prototype", "BA.1")))
naiveDF <- seuObjNaive@meta.data
embeddings <- as.data.frame(Embeddings(seuObjNaive,reduction = "harmony.wnn.umap"))
naiveDF$UMAP_1 <- embeddings$harmonywnnUMAP_1[match(rownames(embeddings), rownames(naiveDF))]
naiveDF$UMAP_2 <- embeddings$harmonywnnUMAP_2[match(rownames(embeddings), rownames(naiveDF))]
#####read in flow data
flowRaw <- read_xlsx(here::here("01_raw-data", "FlowData", "FinalizedDatasets", "Unfiltered_COVAILFlowDataset_250318.xlsx"))
flow <- flowRaw %>%
mutate(TotalRBD = rowSums(select(.,contains("Combined"))),
ProtoNotBeta = rowSums(select(., contains("Proto"), -contains("Beta"))),
BetaNotProto = rowSums(select(., contains("Beta"), -contains("Proto"))),
ProtoBeta = rowSums( select(.,matches("Proto.+Beta"))),
ProtoNotOmicron = rowSums(select(., contains("Proto"), -contains("BA1"))),
OmiNotProto = rowSums(select(., contains("BA1"), -contains("Proto"))),
ProtoOmi = rowSums(select(.,matches("Proto.+BA"))),
Immunogen = str_replace_all(Immunogen, " \\+ ", "/"),
Booster = str_replace_all(Booster, " \\+ ", "/"),
TimepointC = case_when(Timepoint == 1 ~ "Day 0",
Timepoint == 15 ~ "Day 15",
Timepoint == 90 ~ "Day 90",
Timepoint == 180 ~ "Day 180"),
TimepointC = factor(TimepointC, levels = c("Day 0", "Day 15", "Day 90", "Day 180"))) %>% filter(Dataset != "Delta Panel")
#read in evolution data from Abby
evolving <- read.csv(here::here("01_raw-data", "Evo_dat_Timepoint_uniform.csv"))
#####
#####
#create a table for intro graphic
table(naiveDF$Booster, naiveDF$Timepoint)
#####
######
#Compare activation by specificity
########
calcs <- df %>% filter(Timepoint %in% c("Day 0", "Day 15"), adj.ProtoOmi != "Proto-Omi+") %>%
mutate(ClusterLabel = case_when(ClusterLabel %in% c("Intermediate", "Acute Activated") ~ "Activated",
TRUE ~ ClusterLabel)) %>%
mutate(ClusterSpec = paste0(ClusterLabel,"_", adj.ProtoOmi)) %>%
group_by(Booster, Subject, Timepoint, ClusterSpec) %>%
summarize(n = n()) %>%
group_by(Booster)%>%
complete(Subject, Timepoint, ClusterSpec, fill = list(n = 0)) %>%
group_by(Booster, Subject, Timepoint)%>%
mutate(Prop = n / sum(n)) %>%
mutate(ClusterLabel = str_extract(ClusterSpec, "Activated"),
adj.ProtoOmi = ifelse(str_detect(ClusterSpec, "Proto\\+Omi\\+"), "Activated Cross-Reactive", "Activated Prototype-Specific")) %>%
filter(!is.na(ClusterLabel))
#plot out the differences per group
#prototype
calcs %>% filter(Booster == "Prototype") %>%
ggplot(aes(x = Timepoint, y = Prop))+
geom_line(aes(group = Subject, color = adj.ProtoOmi))+
geom_point(aes(fill = adj.ProtoOmi), shape = 21, size = 0.9)+
ylab("Proportion of Total Cells")+
ggtitle("Prototype Boost")+
ylim(0,1)+
facet_grid(cols = vars(adj.ProtoOmi))+
scale_fill_manual(values = c("Activated Prototype-Specific" = "lightgray",
"Activated Cross-Reactive" = "#343148ff"))+
scale_color_manual(values = c("Activated Prototype-Specific" = "lightgray",
"Activated Cross-Reactive" = "#343148ff"))+
theme_classic()+
theme(text = element_text(size = 6),
strip.background = element_blank(),
legend.position = "none",
axis.text.x = element_text(angle = 45, hjust = 1, vjust =1),
plot.title = element_text(hjust = 0.5),
axis.title.x = element_blank())
#proto/BA1
calcs %>% filter(Booster == "BA.1 And Prototype") %>%
ggplot(aes(x = Timepoint, y = Prop))+
geom_line(aes(group = Subject, color = adj.ProtoOmi))+
geom_point(aes(fill = adj.ProtoOmi), shape = 21, size = 0.9)+
ylab("Proportion of Total Cells")+
ylim(0,1)+
ggtitle("Prototype/BA.1 Boost")+
facet_grid(cols = vars(adj.ProtoOmi))+
scale_fill_manual(values = c("Activated Prototype-Specific" = "lightgray",
"Activated Cross-Reactive" = "#343148ff"))+
scale_color_manual(values = c("Activated Prototype-Specific" = "lightgray",
"Activated Cross-Reactive" = "#343148ff"))+
theme_classic()+
theme(text = element_text(size = 6),
strip.background = element_blank(),
legend.position = "none",
axis.text.x = element_text(angle = 45, hjust = 1, vjust =1),
plot.title = element_text(hjust = 0.5),
axis.title.x = element_blank())
#BA.1 vaccine
calcs %>% filter(Booster == "BA.1") %>%
ggplot(aes(x = Timepoint, y = Prop))+
geom_line(aes(group = Subject, color = adj.ProtoOmi))+
geom_point(aes(fill = adj.ProtoOmi), shape = 21, size = 0.9)+
ylab("Proportion of Total Cells")+
ggtitle("BA.1 Boost")+
ylim(0,1)+
facet_grid(cols = vars(adj.ProtoOmi))+
scale_fill_manual(values = c("Activated Prototype-Specific" = "lightgray",
"Activated Cross-Reactive" = "#343148ff"))+
scale_color_manual(values = c("Activated Prototype-Specific" = "lightgray",
"Activated Cross-Reactive" = "#343148ff"))+
theme_classic()+
theme(text = element_text(size = 6),
strip.background = element_blank(),
legend.position = "none",
axis.text.x = element_text(angle = 45, hjust = 1, vjust =1),
plot.title = element_text(hjust = 0.5),
axis.title.x = element_blank())
library(ggplot2)
library(dplyr)
library(here)
library(tidyverse)
library(readxl)
library(writexl)
library(stringr)
library(cowplot)
library(RColorBrewer)
#####
#load in colors
allColors <- c("Prototype mRNA" = "#076894",
"Prototype Protein" = "#73d4ff",
"Beta mRNA" = "#068041",
"Beta Protein" = "#02ba5b",
"Prototype/Beta mRNA" = "#c47002",
"Prototype/Beta Protein" = "#f78c00",
"Prototype/BA.1 mRNA" = "#DC3977",
"Omicron BA.1 mRNA" = "#7C1D6f",
"Beta/BA.1 mRNA" = "wheat1")
#let's work on this
immunogenColors <- c("Prototype" = "#076894",
"Beta" = "#068041",
"Prototype/Beta" = "#c47002",
"Prototype/BA.1" = "#DC3977",
"Omicron BA.1" = "#7C1D6f",
"Beta/BA.1" = "wheat1")
#load in the flow data and make the result
flowRaw <- read_xlsx(here::here("01_raw-data", "FlowData", "FinalizedDatasets", "Filtered_COVAILDataset_250318_CORRECTED.xlsx"))
flow <- flowRaw %>%
mutate(TotalRBD = rowSums(select(.,contains("Combined"))),
ProtoNotBeta = rowSums(select(., contains("Proto"), -contains("Beta"))),
BetaNotProto = rowSums(select(., contains("Beta"), -contains("Proto"))),
ProtoBeta = rowSums( select(.,matches("Proto.+Beta"))),
ProtoNotOmicron = rowSums(select(., contains("Proto"), -contains("BA1"))),
OmiNotProto = rowSums(select(., contains("BA1"), -contains("Proto"))),
ProtoOmi = rowSums(select(.,matches("Proto.+BA"))),
NotProto = rowSums(select(., c("Combined_Beta+/BA1+", "Combined_Beta+", "Combined_BA1+"))),
Immunogen = str_replace_all(Immunogen, " \\+ ", "/"),
Booster = str_replace_all(Booster, " \\+ ", "/"))
flow$Immunogen <- factor(flow$Immunogen, levels = c("Prototype", "Prototype/Beta", "Beta", "Prototype/BA.1", "Omicron BA.1", "Beta/BA.1"))
flow$Booster <- factor(flow$Booster, levels = c("Prototype mRNA", "Prototype Protein",
"Prototype/Beta mRNA", "Prototype/Beta Protein", "Beta mRNA", "Beta Protein",
"Prototype/BA.1 mRNA", "Omicron BA.1 mRNA", "Beta/BA.1 mRNA"))
flow$Timepoint <- factor(flow$Timepoint, levels = c("1", "15","90","180"))
#####
#####
#make boxplots comparing different populations
ba1 %>%
ggplot(aes(x = Timepoint, y = ProtoOmi))+
geom_line(aes(group = `Subject ID`, color = Immunogen), lwd = 0.2, alpha = 0.6)+
geom_boxplot(width= 0.5, lwd = 0.3, outlier.size = 0.9, outlier.shape = 21, outlier.stroke = 0.2, fatten = 1.4, aes(fill = Immunogen))+
ylab("Percent of IgG+")+
xlab("Days Post-Immunization")+
ggtitle("Prototype+BA.1+")+
#ylim(-2.2,1.2)+
ylim(0,10)+
geom_hline(yintercept = 0.08, linetype = 2, linewidth = 0.6)+
#scale_y_continuous(transform = "log10")+
scale_fill_manual(values = immunogenColors)+
scale_color_manual(values = immunogenColors)+
facet_grid(cols = vars(Immunogen))+
theme_classic()+
theme(strip.background = element_blank(),
text = element_text(size = 8),
plot.title = element_text(hjust = 0.5, face = "bold", size = 8),
strip.text.y = element_text(size = 8, face = "bold"),
legend.position = "none")
#####
#make boxplots comparing different populations
ba1 <- flow %>% filter(Immunogen %in% c("Omicron BA.1", "Prototype/BA.1", "Beta/BA.1", "Prototype"))
beta <- flow %>% filter(Immunogen %in% c("Beta", "Prototype", "Prototype/Beta"))
ba1 %>%
ggplot(aes(x = Timepoint, y = ProtoOmi))+
geom_line(aes(group = `Subject ID`, color = Immunogen), lwd = 0.2, alpha = 0.6)+
geom_boxplot(width= 0.5, lwd = 0.3, outlier.size = 0.9, outlier.shape = 21, outlier.stroke = 0.2, fatten = 1.4, aes(fill = Immunogen))+
ylab("Percent of IgG+")+
xlab("Days Post-Immunization")+
ggtitle("Prototype+BA.1+")+
#ylim(-2.2,1.2)+
ylim(0,10)+
geom_hline(yintercept = 0.08, linetype = 2, linewidth = 0.6)+
#scale_y_continuous(transform = "log10")+
scale_fill_manual(values = immunogenColors)+
scale_color_manual(values = immunogenColors)+
facet_grid(cols = vars(Immunogen))+
theme_classic()+
theme(strip.background = element_blank(),
text = element_text(size = 8),
plot.title = element_text(hjust = 0.5, face = "bold", size = 8),
strip.text.y = element_text(size = 8, face = "bold"),
legend.position = "none")
#####
#make boxplots comparing different populations
ba1 <- flow %>% filter(Immunogen %in% c("Omicron BA.1", "Prototype/BA.1", "Beta/BA.1", "Prototype")) %>%
mutate(Immunogen = ifelse(Immunogen == "Omicron BA.1", "BA.1", Immunogen))
beta <- flow %>% filter(Immunogen %in% c("Beta", "Prototype", "Prototype/Beta"))
immunogenColors2 <- c("Prototype" = "#076894",
"Beta" = "#068041",
"Prototype/Beta" = "#c47002",
"Prototype/BA.1" = "#DC3977",
"Omicron BA.1" = "#7C1D6f",
"Beta/BA.1" = "wheat1")
#####
#make boxplots comparing different populations
ba1 <- flow %>% filter(Immunogen %in% c("Omicron BA.1", "Prototype/BA.1", "Beta/BA.1", "Prototype")) %>%
mutate(Immunogen = ifelse(Immunogen == "Omicron BA.1", "BA.1", Immunogen))
beta <- flow %>% filter(Immunogen %in% c("Beta", "Prototype", "Prototype/Beta"))
ba1 %>%
ggplot(aes(x = Timepoint, y = ProtoOmi))+
geom_line(aes(group = `Subject ID`, color = Immunogen), lwd = 0.2, alpha = 0.6)+
geom_boxplot(width= 0.5, lwd = 0.3, outlier.size = 0.9, outlier.shape = 21, outlier.stroke = 0.2, fatten = 1.4, aes(fill = Immunogen))+
ylab("Percent of IgG+")+
xlab("Days Post-Immunization")+
ggtitle("Prototype+BA.1+")+
#ylim(-2.2,1.2)+
ylim(0,10)+
geom_hline(yintercept = 0.08, linetype = 2, linewidth = 0.6)+
#scale_y_continuous(transform = "log10")+
scale_fill_manual(values = immunogenColors2)+
scale_color_manual(values = immunogenColors2)+
facet_grid(cols = vars(Immunogen))+
theme_classic()+
theme(strip.background = element_blank(),
text = element_text(size = 8),
plot.title = element_text(hjust = 0.5, face = "bold", size = 8),
strip.text.y = element_text(size = 8, face = "bold"),
legend.position = "none")
#####
#make boxplots comparing different populations
ba1 <- flow %>% filter(Immunogen %in% c("Omicron BA.1", "Prototype/BA.1", "Beta/BA.1", "Prototype")) %>%
mutate(Immunogen = case_when(Immunogen == "Omicron BA.1" ~ "BA.1",
TRUE ~ Immunogen))
beta <- flow %>% filter(Immunogen %in% c("Beta", "Prototype", "Prototype/Beta"))
ba1 %>%
ggplot(aes(x = Timepoint, y = ProtoOmi))+
geom_line(aes(group = `Subject ID`, color = Immunogen), lwd = 0.2, alpha = 0.6)+
geom_boxplot(width= 0.5, lwd = 0.3, outlier.size = 0.9, outlier.shape = 21, outlier.stroke = 0.2, fatten = 1.4, aes(fill = Immunogen))+
ylab("Percent of IgG+")+
xlab("Days Post-Immunization")+
ggtitle("Prototype+BA.1+")+
#ylim(-2.2,1.2)+
ylim(0,10)+
geom_hline(yintercept = 0.08, linetype = 2, linewidth = 0.6)+
#scale_y_continuous(transform = "log10")+
scale_fill_manual(values = immunogenColors2)+
scale_color_manual(values = immunogenColors2)+
facet_grid(cols = vars(Immunogen))+
theme_classic()+
theme(strip.background = element_blank(),
text = element_text(size = 8),
plot.title = element_text(hjust = 0.5, face = "bold", size = 8),
strip.text.y = element_text(size = 8, face = "bold"),
legend.position = "none")
flow$Immunogen <- factor(flow$Immunogen, levels = c("Prototype", "Prototype/Beta", "Beta", "Prototype/BA.1", "Omicron BA.1", "Beta/BA.1"))
flow$Booster <- factor(flow$Booster, levels = c("Prototype mRNA", "Prototype Protein",
"Prototype/Beta mRNA", "Prototype/Beta Protein", "Beta mRNA", "Beta Protein",
"Prototype/BA.1 mRNA", "Omicron BA.1 mRNA", "Beta/BA.1 mRNA"))
flow$Timepoint <- factor(flow$Timepoint, levels = c("1", "15","90","180"))
#####
#make boxplots comparing different populations
ba1 <- flow %>% filter(Immunogen %in% c("Omicron BA.1", "Prototype/BA.1", "Beta/BA.1", "Prototype")) %>%
mutate(Immunogen = case_when(Immunogen == "Omicron BA.1" ~ "BA.1",
TRUE ~ Immunogen))
beta <- flow %>% filter(Immunogen %in% c("Beta", "Prototype", "Prototype/Beta"))
ba1 %>%
ggplot(aes(x = Timepoint, y = ProtoOmi))+
geom_line(aes(group = `Subject ID`, color = Immunogen), lwd = 0.2, alpha = 0.6)+
geom_boxplot(width= 0.5, lwd = 0.3, outlier.size = 0.9, outlier.shape = 21, outlier.stroke = 0.2, fatten = 1.4, aes(fill = Immunogen))+
ylab("Percent of IgG+")+
xlab("Days Post-Immunization")+
ggtitle("Prototype+BA.1+")+
#ylim(-2.2,1.2)+
ylim(0,10)+
geom_hline(yintercept = 0.08, linetype = 2, linewidth = 0.6)+
#scale_y_continuous(transform = "log10")+
scale_fill_manual(values = immunogenColors2)+
scale_color_manual(values = immunogenColors2)+
facet_grid(cols = vars(Immunogen))+
theme_classic()+
theme(strip.background = element_blank(),
text = element_text(size = 8),
plot.title = element_text(hjust = 0.5, face = "bold", size = 8),
strip.text.y = element_text(size = 8, face = "bold"),
legend.position = "none")
immunogenColors2 <- c("Prototype" = "#076894",
"Beta" = "#068041",
"Prototype/Beta" = "#c47002",
"Prototype/BA.1" = "#DC3977",
"BA.1" = "#7C1D6f",
"Beta/BA.1" = "wheat1")
#load in the flow data and make the result
flowRaw <- read_xlsx(here::here("01_raw-data", "FlowData", "FinalizedDatasets", "Filtered_COVAILDataset_250318_CORRECTED.xlsx"))
flow <- flowRaw %>%
mutate(TotalRBD = rowSums(select(.,contains("Combined"))),
ProtoNotBeta = rowSums(select(., contains("Proto"), -contains("Beta"))),
BetaNotProto = rowSums(select(., contains("Beta"), -contains("Proto"))),
ProtoBeta = rowSums( select(.,matches("Proto.+Beta"))),
ProtoNotOmicron = rowSums(select(., contains("Proto"), -contains("BA1"))),
OmiNotProto = rowSums(select(., contains("BA1"), -contains("Proto"))),
ProtoOmi = rowSums(select(.,matches("Proto.+BA"))),
NotProto = rowSums(select(., c("Combined_Beta+/BA1+", "Combined_Beta+", "Combined_BA1+"))),
Immunogen = str_replace_all(Immunogen, " \\+ ", "/"),
Booster = str_replace_all(Booster, " \\+ ", "/"))
flow$Immunogen <- factor(flow$Immunogen, levels = c("Prototype", "Prototype/Beta", "Beta", "Prototype/BA.1", "Omicron BA.1", "Beta/BA.1"))
flow$Booster <- factor(flow$Booster, levels = c("Prototype mRNA", "Prototype Protein",
"Prototype/Beta mRNA", "Prototype/Beta Protein", "Beta mRNA", "Beta Protein",
"Prototype/BA.1 mRNA", "Omicron BA.1 mRNA", "Beta/BA.1 mRNA"))
flow$Timepoint <- factor(flow$Timepoint, levels = c("1", "15","90","180"))
#####
#make boxplots comparing different populations
ba1 <- flow %>% filter(Immunogen %in% c("Omicron BA.1", "Prototype/BA.1", "Beta/BA.1", "Prototype")) %>%
mutate(Immunogen = case_when(Immunogen == "Omicron BA.1" ~ "BA.1",
TRUE ~ Immunogen))
beta <- flow %>% filter(Immunogen %in% c("Beta", "Prototype", "Prototype/Beta"))
ba1 %>%
ggplot(aes(x = Timepoint, y = ProtoOmi))+
geom_line(aes(group = `Subject ID`, color = Immunogen), lwd = 0.2, alpha = 0.6)+
geom_boxplot(width= 0.5, lwd = 0.3, outlier.size = 0.9, outlier.shape = 21, outlier.stroke = 0.2, fatten = 1.4, aes(fill = Immunogen))+
ylab("Percent of IgG+")+
xlab("Days Post-Immunization")+
ggtitle("Prototype+BA.1+")+
#ylim(-2.2,1.2)+
ylim(0,10)+
geom_hline(yintercept = 0.08, linetype = 2, linewidth = 0.6)+
#scale_y_continuous(transform = "log10")+
scale_fill_manual(values = immunogenColors2)+
scale_color_manual(values = immunogenColors2)+
facet_grid(cols = vars(Immunogen))+
theme_classic()+
theme(strip.background = element_blank(),
text = element_text(size = 8),
plot.title = element_text(hjust = 0.5, face = "bold", size = 8),
strip.text.y = element_text(size = 8, face = "bold"),
legend.position = "none")
#####
#make boxplots comparing different populations
ba1 <- flow %>% filter(Immunogen %in% c("Omicron BA.1", "Prototype/BA.1", "Beta/BA.1", "Prototype")) %>%
mutate(Immunogen = case_when(Immunogen == "Omicron BA.1" ~ "BA.1",
TRUE ~ Immunogen),
Immunogen = factor(Immunogen, levels = c("Prototype", "Prototype/Beta", "Beta", "Prototype/BA.1", "Omicron BA.1", "Beta/BA.1"))))
#####
#make boxplots comparing different populations
ba1 <- flow %>% filter(Immunogen %in% c("Omicron BA.1", "Prototype/BA.1", "Beta/BA.1", "Prototype")) %>%
mutate(Immunogen = case_when(Immunogen == "Omicron BA.1" ~ "BA.1",
TRUE ~ Immunogen),
Immunogen = factor(Immunogen, levels = c("Prototype", "Prototype/Beta", "Beta", "Prototype/BA.1", "Omicron BA.1", "Beta/BA.1")))
beta <- flow %>% filter(Immunogen %in% c("Beta", "Prototype", "Prototype/Beta"))
ba1 %>%
ggplot(aes(x = Timepoint, y = ProtoOmi))+
geom_line(aes(group = `Subject ID`, color = Immunogen), lwd = 0.2, alpha = 0.6)+
geom_boxplot(width= 0.5, lwd = 0.3, outlier.size = 0.9, outlier.shape = 21, outlier.stroke = 0.2, fatten = 1.4, aes(fill = Immunogen))+
ylab("Percent of IgG+")+
xlab("Days Post-Immunization")+
ggtitle("Prototype+BA.1+")+
#ylim(-2.2,1.2)+
ylim(0,10)+
geom_hline(yintercept = 0.08, linetype = 2, linewidth = 0.6)+
#scale_y_continuous(transform = "log10")+
scale_fill_manual(values = immunogenColors2)+
scale_color_manual(values = immunogenColors2)+
facet_grid(cols = vars(Immunogen))+
theme_classic()+
theme(strip.background = element_blank(),
text = element_text(size = 8),
plot.title = element_text(hjust = 0.5, face = "bold", size = 8),
strip.text.y = element_text(size = 8, face = "bold"),
legend.position = "none")
#####
#make boxplots comparing different populations
ba1 <- flow %>% filter(Immunogen %in% c("Omicron BA.1", "Prototype/BA.1", "Beta/BA.1", "Prototype")) %>%
mutate(Immunogen = case_when(Immunogen == "Omicron BA.1" ~ "BA.1",
TRUE ~ Immunogen),
Immunogen = factor(Immunogen, levels = c("Prototype", "Prototype/Beta", "Beta", "Prototype/BA.1", "BA.1", "Beta/BA.1")))
beta <- flow %>% filter(Immunogen %in% c("Beta", "Prototype", "Prototype/Beta"))
ba1 %>%
ggplot(aes(x = Timepoint, y = ProtoOmi))+
geom_line(aes(group = `Subject ID`, color = Immunogen), lwd = 0.2, alpha = 0.6)+
geom_boxplot(width= 0.5, lwd = 0.3, outlier.size = 0.9, outlier.shape = 21, outlier.stroke = 0.2, fatten = 1.4, aes(fill = Immunogen))+
ylab("Percent of IgG+")+
xlab("Days Post-Immunization")+
ggtitle("Prototype+BA.1+")+
#ylim(-2.2,1.2)+
ylim(0,10)+
geom_hline(yintercept = 0.08, linetype = 2, linewidth = 0.6)+
#scale_y_continuous(transform = "log10")+
scale_fill_manual(values = immunogenColors2)+
scale_color_manual(values = immunogenColors2)+
facet_grid(cols = vars(Immunogen))+
theme_classic()+
theme(strip.background = element_blank(),
text = element_text(size = 8),
plot.title = element_text(hjust = 0.5, face = "bold", size = 8),
strip.text.y = element_text(size = 8, face = "bold"),
legend.position = "none")
#####write stats sheets for above
statsba1 <- ba1 %>%
group_by(Booster, Subject, Timepoint) %>%
select(Booster, Subject, Timepoint, ProtoOmi, ProtoNotOmicron, OmiNotProto) %>%
pivot_longer(contains("Proto"), names_to = "AntigenSpecificity")
#####write stats sheets for above
statsba1 <- ba1 %>%
group_by(Booster, `Subject ID`, Timepoint) %>%
select(Booster, `Subject ID`, Timepoint, ProtoOmi, ProtoNotOmicron, OmiNotProto) %>%
pivot_longer(contains("Proto"), names_to = "AntigenSpecificity")
View(statsba1)
#####write stats sheets for above
statsba1 <- ba1 %>%
group_by(Booster, `Subject ID`, Timepoint) %>%
select(Booster, `Subject ID`, Timepoint, ProtoOmi, ProtoNotOmicron, OmiNotProto) %>%
pivot_longer(contains("Proto"), names_to = "AntigenSpecificity") %>%
pivot_wider(names_from = Timepoint, values_from = value)
View(statsba1)
statsbeta <- beta %>%
group_by(Immunogen, `Subject ID`, Timepoint) %>%
select(Booster, `Subject ID`, Timepoint, ProtoBeta, ProtoNotBeta, BetaNotProto) %>%
pivot_longer(contains("Proto"), names_to = "AntigenSpecificity") %>%
pivot_wider(names_from = Timepoint, values_from = value)
View(statsbeta)
#####
#plot clonal lineages over time
clones <- crossDF %>%
group_by(clone_subject_id) %>%
mutate(relative = case_when(unique(InfectionRange) == "Infected Days 15-90" & Timepoint %in% c("Day 90", "Day 180") ~ "Post-infection",
unique(InfectionRange) == "Infected Days 90-180" & Timepoint %in% c("Day 180") ~ "Post-infection",
TRUE ~ "Pre-infection"),
mu_freq = mu_freq * 100)%>%
group_by(InfectionRange, clone_subject_id, relative) %>%
summarize(n = n(),
mean = mean(mu_freq)) %>%
group_by(clone_subject_id) %>%
